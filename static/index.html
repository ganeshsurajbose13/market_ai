<!DOCTYPE html>
<html>
<head>
  <title>Market AI</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f2f2f2; }
  </style>
</head>
<body>

<h2>ðŸ“ˆ Market AI Search</h2>

<input id="symbol" placeholder="RELIANCE.NS">
<button onclick="analyze()">Analyze</button>

<pre id="status"></pre>
<div id="output"></div>

<script>
async function analyze() {
  const s = document.getElementById("symbol").value;
  document.getElementById("status").innerText = "Loading...";
  document.getElementById("output").innerHTML = "";

  try {
    const r = await fetch(`/analyze?symbol=${s}`);
    const d = await r.json();

    if (d.error) {
      document.getElementById("status").innerText = d.error;
      return;
    }

    document.getElementById("status").innerText =
      `${d.symbol} â†’ ${d.signal} (${d.confidence_}%)`;

    let html = "<table><tr><th>TF</th><th>Price</th><th>VWAP</th><th>EMA5</th><th>EMA10</th><th>EMA20</th><th>Trend</th></tr>";

    for (const tf in d.analysis) {
      const a = d.analysis[tf];
      if (a.error) {
        html += `<tr><td>${tf}</td><td colspan="6">${a.error}</td></tr>`;
      } else {
        html += `<tr>
          <td>${tf}</td>
          <td>${a.Price}</td>
          <td>${a.VWAP}</td>
          <td>${a.EMA_5}</td>
          <td>${a.EMA_10}</td>
          <td>${a.EMA_20}</td>
          <td>${a.Guppy_Trend}</td>
        </tr>`;
      }
    }

    html += "</table>";
    document.getElementById("output").innerHTML = html;

  } catch {
    document.getElementById("status").innerText = "Network error";
  }
}
</script>

</body>
</html>
