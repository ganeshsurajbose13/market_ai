<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üìà Market AI Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            padding: 20px;
        }

        h1 {
            color: #38bdf8;
        }

        input, button {
            padding: 10px;
            font-size: 16px;
            margin: 5px 0;
        }

        input {
            width: 220px;
        }

        button {
            background: #22c55e;
            border: none;
            color: black;
            cursor: pointer;
        }

        button:hover {
            background: #16a34a;
        }

        .card {
            background: #020617;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #1e293b;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #334155;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #020617;
            color: #7dd3fc;
        }

        .BUY {
            color: #22c55e;
            font-weight: bold;
        }

        .SELL {
            color: #ef4444;
            font-weight: bold;
        }

        .HOLD {
            color: #facc15;
            font-weight: bold;
        }

        .loading {
            color: #38bdf8;
            margin-top: 10px;
        }

        .error {
            color: #ef4444;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>üìà Market AI Search</h1>

<input id="symbolInput" placeholder="RELIANCE.NS" />
<button onclick="analyze()">Analyze</button>

<div id="status"></div>
<div id="result"></div>

<script>
async function analyze() {
    const symbol = document.getElementById("symbolInput").value.trim();
    const status = document.getElementById("status");
    const result = document.getElementById("result");

    result.innerHTML = "";
    status.innerHTML = "<p class='loading'>‚è≥ Analyzing...</p>";

    if (!symbol) {
        status.innerHTML = "<p class='error'>‚ùå Please enter a symbol</p>";
        return;
    }

    try {
        const res = await fetch(`/analyze?symbol=${symbol}`);
        const data = await res.json();

        if (data.error) {
            status.innerHTML = `<p class='error'>‚ùå ${data.error}</p>`;
            return;
        }

        status.innerHTML = "";
        renderResult(data);

    } catch (err) {
        status.innerHTML = "<p class='error'>‚ùå Server error</p>";
    }
}

function renderResult(data) {
    const result = document.getElementById("result");

    let html = `
        <div class="card">
            <h2>${data.symbol}</h2>
            <p><b>Strategy:</b> ${data.strategy}</p>
        </div>
    `;

    html += `
        <div class="card">
            <table>
                <tr>
                    <th>Timeframe</th>
                    <th>Price</th>
                    <th>EMA 5</th>
                    <th>EMA 10</th>
                    <th>EMA 20</th>
                    <th>EMA 50</th>
                    <th>Trend Strength</th>
                    <th>Confidence</th>
                    <th>Signal</th>
                </tr>
    `;

    for (const tf in data.analysis) {
        const a = data.analysis[tf];

        if (a.error) {
            html += `
                <tr>
                    <td>${tf}</td>
                    <td colspan="8">No Data</td>
                </tr>
            `;
            continue;
        }

        html += `
            <tr>
                <td>${tf}</td>
                <td>${a.Price}</td>
                <td>${a.EMA_5}</td>
                <td>${a.EMA_10}</td>
                <td>${a.EMA_20}</td>
                <td>${a.EMA_50}</td>
                <td>${a.Trend_Strength_%}%</td>
                <td>${a.Learning_Confidence_%}%</td>
                <td class="${a.Signal}">${a.Signal}</td>
            </tr>
        `;
    }

    html += `</table></div>`;
    result.innerHTML = html;
}
</script>

</body>
</html>
