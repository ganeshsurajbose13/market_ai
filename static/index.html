<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üìà Market AI Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            padding: 20px;
        }
        h1 {
            color: #38bdf8;
        }
        input, button {
            padding: 10px;
            font-size: 16px;
            margin-right: 5px;
        }
        button {
            background: #22c55e;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #16a34a;
        }
        .error {
            color: #f87171;
            margin-top: 15px;
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #334155;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #1e293b;
        }
        .signal-buy {
            color: #22c55e;
            font-weight: bold;
        }
        .signal-sell {
            color: #ef4444;
            font-weight: bold;
        }
        .signal-hold {
            color: #facc15;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>üìà Market AI Search</h1>

<input id="symbolInput" placeholder="e.g. BHEL.NS" />
<button onclick="analyzeStock()">Analyze</button>

<div id="status"></div>
<div id="result"></div>

<script>
async function analyzeStock() {
    const symbol = document.getElementById("symbolInput").value.trim();
    const status = document.getElementById("status");
    const result = document.getElementById("result");

    result.innerHTML = "";
    status.innerHTML = "‚è≥ Fetching data...";

    if (!symbol) {
        status.innerHTML = "<span class='error'>Please enter a stock symbol</span>";
        return;
    }

    try {
        const response = await fetch(`/analyze?symbol=${symbol}`);

        if (!response.ok) {
            throw new Error("API not reachable");
        }

        const data = await response.json();

        if (data.error) {
            status.innerHTML = `<span class='error'>${data.error}</span>`;
            return;
        }

        status.innerHTML = `
            <h2>
                ${data.symbol} ‚Äî
                <span class="signal-${data.signal.toLowerCase()}">
                    ${data.signal} (${data.confidence_%}%)
                </span>
            </h2>
        `;

        const tf = data.analysis;

        result.innerHTML = `
            <table>
                <tr>
                    <th>Timeframe</th>
                    <th>Price</th>
                    <th>VWAP</th>
                    <th>EMA 5</th>
                    <th>EMA 10</th>
                    <th>EMA 20</th>
                    <th>EMA Cross</th>
                    <th>Guppy</th>
                </tr>
                ${row("Daily", tf.Daily)}
                ${row("Weekly", tf.Weekly)}
                ${row("Monthly", tf.Monthly)}
            </table>
        `;

    } catch (err) {
        status.innerHTML = "<span class='error'>‚ùå Network or API error</span>";
        console.error(err);
    }
}

function row(name, d) {
    if (!d || d.error) {
        return `
            <tr>
                <td>${name}</td>
                <td colspan="7">No data</td>
            </tr>
        `;
    }
    return `
        <tr>
            <td>${name}</td>
            <td>${d.Price ?? "-"}</td>
            <td>${d.VWAP ?? "-"}</td>
            <td>${d.EMA_5 ?? "-"}</td>
            <td>${d.EMA_10 ?? "-"}</td>
            <td>${d.EMA_20 ?? "-"}</td>
            <td>${d.EMA_Cross}</td>
            <td>${d.Guppy}</td>
        </tr>
    `;
}
</script>

</body>
</html>
