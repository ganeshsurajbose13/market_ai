<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üìà Market AI Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            padding: 20px;
        }
        h1 {
            color: #38bdf8;
        }
        input {
            padding: 8px;
            width: 200px;
        }
        button {
            padding: 8px 12px;
            cursor: pointer;
            background: #22c55e;
            border: none;
            font-weight: bold;
        }
        table {
            border-collapse: collapse;
            margin-top: 20px;
            width: 100%;
        }
        th, td {
            border: 1px solid #334155;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #1e293b;
        }
        .error {
            color: #f87171;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h1>üìà Market AI Search</h1>

<input id="symbol" placeholder="BHEL.NS" />
<button onclick="analyze()">Analyze</button>

<div id="result"></div>

<script>
async function analyze() {
    const symbol = document.getElementById("symbol").value.trim();
    const resultDiv = document.getElementById("result");

    if (!symbol) {
        resultDiv.innerHTML = "<p class='error'>Enter a symbol</p>";
        return;
    }

    resultDiv.innerHTML = "‚è≥ Loading...";

    try {
        const response = await fetch(`/analyze?symbol=${symbol}`);
        const data = await response.json();

        if (data.error) {
            resultDiv.innerHTML = `<p class="error">${data.error}</p>`;
            return;
        }

        let html = `
        <h2>${data.symbol} ‚Äî ${data.signal} (${data.confidence_}% confidence)</h2>
        <table>
            <tr>
                <th>Timeframe</th>
                <th>Price</th>
                <th>VWAP</th>
                <th>EMA 5</th>
                <th>EMA 10</th>
                <th>EMA 20</th>
                <th>Trend</th>
            </tr>
        `;

        for (const tf in data.analysis) {
            const a = data.analysis[tf];
            html += `
            <tr>
                <td>${tf}</td>
                <td>${a.Price ?? "-"}</td>
                <td>${a.VWAP ?? "-"}</td>
                <td>${a.EMA_5 ?? "-"}</td>
                <td>${a.EMA_10 ?? "-"}</td>
                <td>${a.EMA_20 ?? "-"}</td>
                <td>${a.Guppy ?? "-"}</td>
            </tr>
            `;
        }

        html += "</table>";
        resultDiv.innerHTML = html;

    } catch (err) {
        resultDiv.innerHTML = `<p class="error">Network error</p>`;
        console.error(err);
    }
}
</script>

</body>
</html>
